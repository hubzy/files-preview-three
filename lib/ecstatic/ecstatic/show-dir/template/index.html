<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Files-Preview</title>
  <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="./favicon.ico">
  <script src="./vue@v2.6.14.js"></script>
  <link rel="stylesheet" href="./template.css">
  <meta name="referrer" content="never">
</head>

<body>
  <div id="app">
    <header :class="['header-wrap',{blurHeder:blurHeder}]">
      <div class="header">
        <div class="logo">FILES PREVIEW</div>
      </div>
    </header>
    <div class="hero" style="background-image: url('https://api.isoyu.com/bing_images.php')">
    </div>
    <main class="content" ref="content">

      <h2 class="title">
        <a :href="path[path.length-2].path" class="back-icon" v-if="path && path.length >= 2"></a>
        <span>{{currentName == '/' ? '项目总览': currentName || '项目总览' }}</span>
      </h2>
      <p class="path">
        快速导航 :
        <template v-for="(item,index) in path">
          <a :href="item.path" :key="index">{{item.text || 'Home'}}</a>
          <span :key="'split_'+index" class="nav-split" v-if="index < path.length - 1">/</span>
        </template>
      </p>


      <ul class="project-list row row-4" v-if="project.length > 0">
        <li class="project-item col-item" v-for="(item,index) in getProjectList" :key="index">
          <a class="project" :href="item.name+'/'">
            <div class="project-cover" :style="{backgroundImage:`url('`+item.cover+`')`}"></div>
            <div class="project-info">
              <div class="file-name">{{item.name}}</div>
              <div class="update-time">{{getUpdateTime(item.dirData.mtimeMs)}}</div>
            </div>
          </a>
        </li>
      </ul>


      <div class="file-type-wrap type-folder" v-if="folder.length > 0">
        <div class="file-type-name">
          文件夹
        </div>

        <ul class="folder row row-6">
          <li class="col-item" v-for="(item,index) in folder" :key="index">
            <a :href="item.name+'/'" class="folder-item">
              <!-- <i class="folder-icon"></i> -->
              <svg width="100%" viewBox="0 0 188 159" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g filter="url(#filter0_d)">
                  <path
                    d="M38.661 116.318H150C154.418 116.318 158 112.736 158 108.318V33.7879C158 29.3696 154.418 25.7879 150 25.7879H95.1835C92.705 25.7879 90.4202 24.4478 89.2105 22.2846C88.0009 20.1214 85.7161 18.7813 83.2376 18.7813H38.661C34.2427 18.7813 30.661 22.363 30.661 26.7813V108.318C30.661 112.736 34.2428 116.318 38.661 116.318Z"
                    fill="#007EDC" />
                  <rect x="39" y="31" width="110" height="83" rx="6" fill="black" fill-opacity="0.05" />
                  <rect x="40" y="32.8228" width="108" height="82.1833" rx="6" fill="white" />
                  <path
                    d="M150 115.414H38.6611C34.2429 115.414 30.6611 111.833 30.6611 107.414V51C30.6611 46.5817 34.2429 43 38.6611 43H150C154.418 43 158 46.5817 158 51V107.414C158 111.833 154.418 115.414 150 115.414Z"
                    fill="black" fill-opacity="0.06" />
                  <path
                    d="M150 116.318H38.6611C34.2429 116.318 30.6611 112.736 30.6611 108.318V52.8045C30.6611 48.3862 34.2429 44.8045 38.6611 44.8045H150C154.418 44.8045 158 48.3862 158 52.8045V108.318C158 112.736 154.418 116.318 150 116.318Z"
                    fill="#0092FF" />
                  <path
                    d="M150 116.318H38.6611C34.2429 116.318 30.6611 112.736 30.6611 108.318V52.8045C30.6611 48.3862 34.2429 44.8045 38.6611 44.8045H150C154.418 44.8045 158 48.3862 158 52.8045V108.318C158 112.736 154.418 116.318 150 116.318Z"
                    fill="url(#paint0_linear)" fill-opacity="0.1" />
                </g>
                <defs>
                  <filter id="filter0_d" x="0.661133" y="0.781319" width="187.339" height="157.536"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                      result="hardAlpha" />
                    <feOffset dy="12" />
                    <feGaussianBlur stdDeviation="15" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape" />
                  </filter>
                  <linearGradient id="paint0_linear" x1="117" y1="36" x2="117" y2="116" gradientUnits="userSpaceOnUse">
                    <stop stop-opacity="0" />
                    <stop offset="1" />
                  </linearGradient>
                </defs>
              </svg>

              <div class="file-name">{{item.name}} </div>
            </a>
          </li>
        </ul>
      </div>


      <div class="file-type-wrap type-image" v-if="images.length > 0">
        <div class="file-type-name">图片</div>
        <ul class="images row row-6">
          <li class="col-item" v-for="(item,index) in images" :key="index">
            <a href="javascript:void(0);" class="images-item">
              <div class="image-preview">
                <div class="preview" :style="{backgroundImage:`url('`+current + item.fileName+`')`}">
                  <img @click.ctrl="e => openFile(e,current + item.fileName)" :src="current + item.fileName" />
                </div>
                <operation :action-list="imgAction" :value="item" @click-item="imageAction"></operation>
              </div>
              <div class="file-name">{{item.fileName}}</div>
            </a>
          </li>
        </ul>
      </div>

      <div class="file-type-wrap type-image" v-if="modelGlb.length > 0">
        <script src="./three.min.js"></script>
        <script src="./OrbitControls.js"></script>
        <script src="./GLTFLoader.js"></script>
        <script src="./RGBELoader.js"></script>
        <script src="./DRACOLoader.js"></script>
        <div class="file-type-name">三维模型</div>
        <ul class="images row row-4">
          <li class="col-item" v-for="(item,index) in modelGlb" :key="index">
            <span class="modelBorderContainer"
              v-on:click="modePopup(item.fileName,current+item.fileName,modelGlb.length)">
              <div class="update-time">{{getUpdateTime(item.dirData.mtimeMs)}}</div>
              <modelscale :model="item.fileName" :src="current+item.fileName" :index="Number(index)" :width=282
                :height=240>
              </modelscale>
              <operation style="right:35px" :action-list="imgAction" :value="item" @click-item="imageAction">
              </operation>
            </span>
          </li>
        </ul>
      </div>
      <!-- 模型弹窗 -->
      <div class="viewer-container viewer-backdrop viewer-fixed viewer-fade viewer-transition viewer-in"
        style="z-index: 2015;" v-if="modePopupData">
        <div class="viewer-canvas">
          <modelscale :model="modePopupDataModel" :src="modePopupDataSrc" :index="modePopupDataIndex"
            :width="modePopupDataWidth" :height="modePopupDataHeight"></modelscale>
        </div>
        <div class="viewer-button viewer-close" v-on:click="closeModePopup"></div>
      </div>

      <div class="file-type-wrap type-folder" v-if="otherFiles.length > 0">
        <div class="file-type-name">其他文件</div>
        <ul class="folder row row-6">
          <li class="col-item" v-for="(item,index) in otherFiles" :key="index">
            <a :href="item.fileName" class="folder-item">
              <!-- <i class="folder-icon"></i> -->
              <svg v-if="item.fileName.split('.').pop()=='zip' && 'rar' " width="80px" height="100px"
                viewBox="0 0 80 100" xmlns="http://www.w3.org/2000/svg">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="zip">
                    <path
                      d="M8,100 L72,100 C76.418,100 80,96.418 80,92 L80,23.3137 C80,21.192 79.157,19.1571 77.657,17.6569 L62.3431,2.3431 C60.8429,0.8429 58.808,0 56.6863,0 L8,0 C3.5817,0 0,3.5817 0,8 L0,92 C0,96.418 3.5817,100 8,100 Z"
                      fill="#FFC146" fill-rule="nonzero"></path>
                    <path
                      d="M72,99 L8,99 C4.134,99 1,95.866 1,92 L1,8 C1,4.134 4.134,1 8,1 L56.6863,1 C58.5428,1 60.3233,1.7375 61.636,3.0502 L76.95,18.364 C78.262,19.6767 79,21.4572 79,23.3137 L79,92 C79,95.866 75.866,99 72,99 Z"
                      stroke-opacity="0.05" stroke="#000000" stroke-width="2"></path>
                    <path
                      d="M62,22 L75.586,22 C76.477,22 76.923,20.9229 76.293,20.2929 L59.7071,3.7071 C59.0771,3.0771 58,3.5233 58,4.4142 L58,18 C58,20.2091 59.7909,22 62,22 Z"
                      fill-opacity="0.65" fill="#FFFFFF" fill-rule="nonzero"></path>
                    <path
                      d="M14.3068411,23.4607809 L21.7553863,23.4607809 C22.5739764,23.4607809 23.23843,22.7982827 23.23843,21.9821016 L23.23843,14.5554762 C23.23843,13.7382566 22.5739764,13.0767968 21.7553863,13.0767968 L14.3068411,13.0767968 C13.488251,13.0767968 12.8237974,13.739295 12.8237974,14.5554762 L12.8237974,21.9821016 C12.8237974,22.7982827 13.488251,23.4607809 14.3068411,23.4607809 Z M32.1700189,23.4607809 L24.7214737,23.4607809 C23.9028836,23.4607809 23.23843,24.1232791 23.23843,24.9394603 L23.23843,32.3660857 C23.23843,33.1833052 23.9028836,33.844765 24.7214737,33.844765 L32.1700189,33.844765 C32.988609,33.844765 33.6530626,33.1822668 33.6530626,32.3660857 L33.6530626,24.9394603 C33.6530626,24.1232791 32.988609,23.4607809 32.1700189,23.4607809 Z M14.3068411,44.2287491 L21.7553863,44.2287491 C22.5739764,44.2287491 23.23843,43.5662509 23.23843,42.7500698 L23.23843,35.3234444 C23.23843,34.5062248 22.5739764,33.844765 21.7553863,33.844765 L14.3068411,33.844765 C13.488251,33.844765 12.8237974,34.5072632 12.8237974,35.3234444 L12.8237974,42.7500698 C12.8237974,43.5662509 13.488251,44.2287491 14.3068411,44.2287491 Z M32.1700189,44.2287491 L24.7214737,44.2287491 C23.9028836,44.2287491 23.23843,44.8912473 23.23843,45.7074285 L23.23843,53.1340539 C23.23843,53.9512734 23.9028836,54.6127332 24.7214737,54.6127332 L32.1700189,54.6127332 C32.988609,54.6127332 33.6530626,53.950235 33.6530626,53.1340539 L33.6530626,45.7074285 C33.6530626,44.8912473 32.988609,44.2287491 32.1700189,44.2287491 Z M30.012107,60.3457308 L16.0429604,60.3457308 C14.2651826,60.3457308 12.8237974,61.7828742 12.8237974,63.5554203 L12.8237974,79.7004388 C12.8237974,81.4729849 14.2651826,82.9101283 16.0429604,82.9101283 L30.012107,82.9101283 C31.7898848,82.9101283 33.2312699,81.4729849 33.2312699,79.7004388 L33.2312699,63.5554203 C33.2312699,61.7828742 31.7898848,60.3457308 30.012107,60.3457308 Z M29.4986656,77.4367303 C29.4986656,78.8614129 28.3405585,80.0161119 26.9116709,80.0161119 L19.142355,80.0161119 C17.7134674,80.0161119 16.5553603,78.8614129 16.5553603,77.4367303 L16.5553603,74.5956722 C16.5553603,73.1709896 17.7134674,72.0162906 19.142355,72.0162906 L26.9116709,72.0162906 C28.3405585,72.0162906 29.4986656,73.1709896 29.4986656,74.5956722 L29.4986656,77.4367303 Z"
                      fill-opacity="0.65" fill="#FFFFFF" fill-rule="nonzero"></path>
                  </g>
                </g>
              </svg>

              <svg v-else width="80px" height="100px" viewBox="0 0 80 100" xmlns="http://www.w3.org/2000/svg">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="file">
                    <path
                      d="M8,100 L72,100 C76.418,100 80,96.418 80,92 L80,23.3137 C80,21.192 79.157,19.1571 77.657,17.6569 L62.3431,2.3431 C60.8429,0.8429 58.808,0 56.6863,0 L8,0 C3.5817,0 0,3.5817 0,8 L0,92 C0,96.418 3.5817,100 8,100 Z"
                      fill="#0190FB" fill-rule="nonzero"></path>
                    <path
                      d="M72,99 L8,99 C4.134,99 1,95.866 1,92 L1,8 C1,4.134 4.134,1 8,1 L56.6863,1 C58.5428,1 60.3233,1.7375 61.636,3.0502 L76.95,18.364 C78.262,19.6767 79,21.4572 79,23.3137 L79,92 C79,95.866 75.866,99 72,99 Z"
                      stroke-opacity="0.05" stroke="#000000" stroke-width="2"></path>
                    <path
                      d="M41.4142,49.1925 C40.6332,48.4114 40.6332,47.1451 41.4142,46.364 L46.364,41.4143 C47.145,40.6332 48.4113,40.6332 49.1924,41.4143 L54.1421,46.364 C54.9232,47.1451 54.9232,48.4114 54.1421,49.1925 L49.1924,54.1422 C48.4113,54.9232 47.145,54.9232 46.364,54.1422 L41.4142,49.1925 Z M27,42 C25.8954,42 25,42.8955 25,44 L25,52 C25,53.1046 25.8954,54 27,54 L35,54 C36.1046,54 37,53.1046 37,52 L37,44 C37,42.8955 36.1046,42 35,42 L27,42 Z M27,59.5564 C25.8954,59.5564 25,60.4519 25,61.5564 L25,69.5564 C25,70.661 25.8954,71.5564 27,71.5564 L35,71.5564 C36.1046,71.5564 37,70.661 37,69.5564 L37,61.5564 C37,60.4519 36.1046,59.5564 35,59.5564 L27,59.5564 Z M43,59.5564 C41.8954,59.5564 41,60.4519 41,61.5564 L41,69.5564 C41,70.661 41.8954,71.5564 43,71.5564 L51,71.5564 C52.1046,71.5564 53,70.661 53,69.5564 L53,61.5564 C53,60.4519 52.1046,59.5564 51,59.5564 L43,59.5564 Z"
                      fill="#9BD5FF"></path>
                    <path
                      d="M62,22 L75.586,22 C76.477,22 76.923,20.9229 76.293,20.2929 L59.7071,3.7071 C59.0771,3.0771 58,3.5233 58,4.4142 L58,18 C58,20.2091 59.7909,22 62,22 Z"
                      fill="#67BCFD" fill-rule="nonzero"></path>
                  </g>
                </g>
              </svg>

              <div class="file-name">{{item.fileName}}</div>
            </a>
          </li>
        </ul>
      </div>
      <div class="no-file" v-if="treeData.dirs.length == '1' && treeData.renderFiles.length == '0' ">No File</div>

    </main>
    <footer id="footer">Files preview · <a href="https://gitee.com/hubzyy/files-preview-three">Gitee 地址</a> · <a
        href="https://gitee.com/hubzyy/files-preview-three">关于</a></footer>
  </div>
  <script>

    function _slicedToArray(arr, i) {
      return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
    }

    function _nonIterableRest() {
      throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
    }

    function _unsupportedIterableToArray(o, minLen) {
      if (!o) return;
      if (typeof o === "string") return _arrayLikeToArray(o, minLen);
      var n = Object.prototype.toString.call(o).slice(8, -1);
      if (n === "Object" && o.constructor) n = o.constructor.name;
      if (n === "Map" || n === "Set") return Array.from(o);
      if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
    }

    function _arrayLikeToArray(arr, len) {
      if (len == null || len > arr.length) len = arr.length;

      for (var i = 0, arr2 = new Array(len); i < len; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    }

    function _iterableToArrayLimit(arr, i) {
      var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];

      if (_i == null) return;
      var _arr = [];
      var _n = true;
      var _d = false;

      var _s, _e;

      try {
        for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {
          _arr.push(_s.value);

          if (i && _arr.length === i) break;
        }
      } catch (err) {
        _d = true;
        _e = err;
      } finally {
        try {
          if (!_n && _i["return"] != null) _i["return"]();
        } finally {
          if (_d) throw _e;
        }
      }

      return _arr;
    }

    function _arrayWithHoles(arr) {
      if (Array.isArray(arr)) return arr;
    }

    var treeData = '{{treeData}}';

    (function () {
      var weeks_ch = ["日", "一", "二", "三", "四", "五", "六"];
      var dateType = "yyyy|y|mm|m|dd|d|hh|h|ii|i|ss|s";
      var imgExt = ['png', 'jpg', 'jpeg', 'svg', 'gif', 'webp', 'bmp', 'tif', 'svga'];
      var modeExt = ['glb', 'gltf']
      var beforeTime = [{
        time: 31536000000,
        format: 'YYYY年MM月DD日 更新',
        useDiffTime: false
      }, {
        time: 259200000,
        format: 'MM月DD日 更新',
        useDiffTime: false
      }, {
        time: 86400000,
        format: 'D天前 更新',
        useDiffTime: 'day'
      }, {
        time: 0,
        format: 'h小时前 更新',
        useDiffTime: 'hours'
      }];
      var app = new Vue({
        el: '#app',
        data: {
          project: [],
          folder: [],
          imageObj: [],
          path: [],
          otherFiles: [],
          blurHeder: true,
          current: treeData.current,
          modePopupData: false,
          modePopupDataModel: null,
          modePopupDataSrc: null,
          modePopupDataIndex: null,
          modePopupDataWidth: `${document.documentElement.clientWidth}`,
          modePopupDataHeight: `${document.documentElement.clientHeight}`,
          imgAction: [{
            name: '下载文件',
            fn: 'downloadFile'
          }, {
            name: '复制链接',
            fn: 'copyLink'
          }]
        },
        created: function created() {

          this.initFileList();
          this.initFloder();
          this.initNav();
        },
        mounted: function mounted() {
          var _this = this;
          this.$nextTick(function () {
            window.addEventListener("scroll", _this.handleScroll); // 监听（绑定）滚轮滚动事件

            _this.handleScroll();
          });

          this.initViewer()
        },
        beforeDestroy: function beforeDestroy() {
          window.removeEventListener("scroll", this.handleScroll);
        },
        computed: {
          getProjectList: function getProjectList() {
            var _list = this.project || [];

            _list = _list.sort(function (item, item2) {
              return item2.mtimeMs - item.mtimeMs;
            });
            return _list;
          }
        },
        methods: {

          openFile(event, url) {
            event.preventDefault();
            window.open(url, '_blank')
          },
          modePopup(mode, src, index) {
            this.modePopupData = true;
            this.modePopupDataModel = mode;
            this.modePopupDataSrc = src;
            this.modePopupDataIndex = index;
            document.getElementsByTagName('body')[0].style.overflow = 'hidden';
          },
          closeModePopup() {
            this.modePopupData = false;
            document.getElementsByTagName('body')[0].style.overflow = '';
          },

          // 操作图片
          imageAction(actionItem, itemInfo) {
            let fn = actionItem.fn
            if (this[fn]) {
              this[fn](itemInfo)
            }
          },

          downloadFile(itemInfo) {
            const a = document.createElement("a");
            a.href = window.location.href + itemInfo.fileName;
            a.download = itemInfo.fileName;
            a.click();
            a.remove();
          },

          copyLink(itemInfo) {
            var copy = function (e) {
              e.preventDefault()
              e.clipboardData.setData('text/plain', window.location.href + itemInfo.fileName)

              window.VsToast.show({
                title: '复制成功',
                variant: 'success',
                timeout: 3000
              });

              document.removeEventListener('copy', copy)
            }
            document.addEventListener('copy', copy)
            document.execCommand("Copy");
          },

          initViewer() {
            if (window.Viewer) {
              let viewer = new window.Viewer(document.querySelector('.type-image'), {
                inline: false,
                viewed() {
                  // viewer.zoomTo(1);
                },
              });
            } else {
              setTimeout(() => {
                this.initViewer()
              }, 50)
            }
          },

          getUpdateTime: function getUpdateTime(time) {
            time = parseInt(time);
            var nowTime = new Date().getTime();
            var diffTime = nowTime - time;
            var formatStr = 'YYYY年MM月DD日 更新';
            var useDiffTime = false;
            beforeTime.some(function (item) {
              if (diffTime >= item.time) {
                formatStr = item.format;
                useDiffTime = item.useDiffTime;
                return true;
              }

              return false;
            });

            if (!useDiffTime) {
              return this.formateTime(time, formatStr);
            } else {
              return this.calcTime(diffTime, useDiffTime);
            }
          },
          // 计算相差的时间
          // TODO 支持 format 格式
          calcTime: function calcTime(time) {
            var diffType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'hours'; // 转换时间对象
            // var timeObj = this.timeToDateObj(time)

            switch (diffType) {
              case 'day':
                return parseInt(time / 86400000) + '天前 更新';

              case 'hours':
                return parseInt(time / 3600000) + '小时前 更新';
            }
          },

          /**
           * 格式化时间戳
           * @param  {Number}    time           需要转换的时间戳。默认当前时间
           * @param  {String}    format         时间格式 默认 yyyy-mm-dd HH:ii:ss
           * @return {String}    timeStr        格式化后的字符串
           */
          formateTime: function formateTime() {
            var _this2 = this;

            var time = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date().getTime();
            var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "yyyy-mm-dd hh:ii:ss";
            time = parseInt(time); // 转换时间对象

            var timeObj = this.timeToDateObj(time); // 正则

            format = format.toLocaleLowerCase().match(new RegExp(dateType + "|.", "g")) || []; // 匹配格式

            format.forEach(function (v, i) {
              if (/yyyy|y/.test(v)) {
                //年
                format[i] = _this2.digit(timeObj.year, v.length);
              } else if (/mm|m/.test(v)) {
                //月
                format[i] = _this2.digit(timeObj.month, v.length);
              } else if (/dd|d/.test(v)) {
                //日
                format[i] = _this2.digit(timeObj.day, v.length);
              } else if (/hh|h/.test(v)) {
                //时
                format[i] = _this2.digit(timeObj.hours, v.length);
              } else if (/ii|i/.test(v)) {
                //分
                format[i] = _this2.digit(timeObj.minutes, v.length);
              } else if (/ss|s/.test(v)) {
                //秒
                format[i] = _this2.digit(timeObj.seconds, v.length);
              }
            });
            return format.join("");
          },

          /**
          * 数字前置补零
          * @param  {Number}  num     传入的数字
          * @param  {Number}  length  需要的长度。默认2位
          * @return {Number}  num     转换好的数字
          */
          digit: function digit(num) {
            var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;
            var str = "";
            num = String(num);
            length = length || 2;

            for (var i = num.length; i < length; i++) {
              str += "0";
            }

            return num < Math.pow(10, length) ? str + (num | 0) : num;
          },

          /**
           * 时间戳转换为对象 (new Date()) => (timeObject)
           * @param  {Number}   time   传入原时间
           * @return {Object}   object 转换后的时间戳，和时间对象
           */
          timeToDateObj: function timeToDateObj() {
            var time = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date().getTime();
            var date = new Date();
            date.setTime(time);
            return {
              time: time,
              day: date.getDate(),
              month: date.getMonth() + 1,
              year: date.getFullYear(),
              week: weeks_ch[date.getDay()],
              hours: date.getHours(),
              minutes: date.getMinutes(),
              seconds: date.getSeconds(),
              monthStr: this.digit(date.getMonth() + 1),
              dayStr: this.digit(date.getDate()),
              hoursStr: this.digit(date.getHours()),
              minutesStr: this.digit(date.getMinutes()),
              secondsStr: this.digit(date.getSeconds())
            };
          },
          handleScroll: function handleScroll() {
            var scrollHeight = document.documentElement.scrollTop || document.body.scrollTop; //滚动高度

            if (scrollHeight >= 100) {
              this.blurHeder = true;
            } else {
              this.blurHeder = false;
            }
          },

          initNav: function initNav() {
            var routes = treeData.current.split('/');
            var path = '';
            var paths = [];
            routes.forEach(function (item, index) {
              (item || index == 0) && paths.push({
                text: item || 'Home',
                path: path += item + '/'
              });
            });
            this.currentName = paths[paths.length - 1].text;
            this.path = paths;
          },
          initFloder: function initFloder() {
            var _this4 = this;

            var dirs = treeData.dirs; // 项目目录

            var projectList = []; // 普通文件夹

            var folderList = [];
            // console.log(dirs)
            for (const item of dirs) {
              let _item = _slicedToArray(item, 2);
              let name = _item[0];
              let dirData = _item[1];
              let cover = _item[2];

              if (name !== '..') {
                if (cover) {
                  projectList.push({
                    dirData: dirData,
                    name: name,
                    cover: cover
                  });
                } else {
                  folderList.push({
                    dirData: dirData,
                    name: name
                  });
                }

                var imgInfo = false;
              }
            };
            this.project = projectList || [];
            this.folder = folderList || [];
          },
          initFileList: function initFileList() {
            var files = treeData.renderFiles;
            var imageObj = {};
            var images = [];
            var otherFiles = [];
            var modelGlb = new Array;
            files.forEach(function (item) {
              var fileName = item[0];
              var nameArr = fileName.split('.');
              var ext = nameArr.pop();
              fileName = nameArr.join('.');

              // // feature 当前目录下包含MD文件，自动进入MD视图
              // if (ext === 'md') {
              //   window.location.href += item[0]
              // }

              if (imgExt.indexOf(ext) !== -1) {
                // imageObj[fileName] = {
                //   fileName: item[0],
                //   ...item[1]
                // }
                images.push({
                  fileName: item[0],
                  dirData: item[1]
                });
              } else if (modeExt.indexOf(ext) !== -1) {
                modelGlb.push({
                  fileName: item[0],
                  dirData: item[1]
                });
              } else {
                otherFiles.push({
                  fileName: item[0],
                  dirData: item[1]
                });
              }
            }); // this.imageObj = imageObj
            this.images = images;
            this.modelGlb = modelGlb;
            this.otherFiles = otherFiles;

          }
        }
      });


      Vue.component('operation', {
        template: `
    <div ref="operation" :class="['operation-wrap',{open:open}]" @click.stop="toggleOpen" v-if="actionList.length">
      <div class="operation">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>

      <div :class="['operation-list-wrap',{open:open}]">
        <div class="operation-list">
          <div class="operation-item" v-for="(item,index) in actionList" :key="index" @click.stop="clickItem(item)">{{item.name}}</div>
        </div>
      </div>
    </div>
    `,
        props: {
          actionList: {
            type: Array,
            default: function () {
              return []
            }
          },
          value: {
            type: Object,
            default: function () {
              return {}
            }
          }
        },
        data() {
          return {
            open: false
          }
        },
        mounted() {
          let _this = this
          document.body.addEventListener('click', _this.bodyClick, false)
          app.$on('openOperation', function () {
            _this.bodyClick()
          })
        },
        destroyed() {
          document.body.removeEventListener('click', this.bodyClick, false)
        },
        methods: {
          bodyClick(event) {
            this.open = false
          },
          toggleOpen() {
            app.$emit('openOperation')
            this.$nextTick(() => {
              this.open = !this.open
            })
          },
          clickItem(item) {
            this.$emit('click-item', item, this.value)
            this.open = false
          }
        }
      })

      Vue.component('modelscale', {
        template: `
            <div>
              <div id="modelBorder" class="modelBorder"></div>
              <div class="file-name">{{(loadedData == '100' ) ? model : '加载中' +loadedData+'%'}}</div>
            </div>
    `,
        props: {
          model: Array,
          src: Array,
          width: Number,
          height: Number,
          index: Number,
        },
        data: function () {
          return {
            scene: null,
            camera: null,
            renderer: null,
            index: null,
            group: null,
            rotating: true,
            loadedData: 0,

          }
        },
        mounted() {

        },
        methods: {

          init() {
            let self = this; //这一点很重要。

            self.clock = new THREE.Clock();


            var camera = new THREE.PerspectiveCamera(45, this.width / this.height, 0.1, 1000);
            self.camera = camera
            self.camera.position.set(0, 0, 100);

            self.scene = new THREE.Scene();
            self.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            self.renderer.setPixelRatio(window.devicePixelRatio);
            self.renderer.setSize(this.width, this.height);
            self.renderer.toneMapping = THREE.ACESFilmicToneMapping;
            self.renderer.toneMappingExposure = 1;
            self.renderer.outputEncoding = THREE.sRGBEncoding;
            self.renderer.shadowMapEnabled = true;

            //插入div
            document.getElementsByClassName("modelBorder")[self.index].appendChild(self.renderer.domElement);

            // container.appendChild(renderer.domElement);
            let controls = new THREE.OrbitControls(camera, self.renderer.domElement);
            // controls.enableDamping = true;
            // controls.minDistance = 0.5;
            // controls.maxDistance = 1;
            // controls.target.set(0, 1, 0);
            // controls.update();
            window.addEventListener('resize', this.onWindowResize);


            new THREE.RGBELoader()
              // .setPath('pisaHDR/')
              .load('./venice_sunset_1k.hdr', function (texture) {

                texture.mapping = THREE.EquirectangularReflectionMapping;
                // scene.background = texture;
                self.scene.environment = texture;
                // model
                new THREE.GLTFLoader()
                  // .setPath( 'models/gltf/' )
                  .setDRACOLoader(new THREE.DRACOLoader().setDecoderPath())
                  .load(self.src, function (gltf) {
                    // console.log(self.src)
                    let loadscene = gltf.scene;
                    loadscene.scale.set(1, 1, 1);
                    // mixer = new THREE.AnimationMixer( gltf.scene );
                    // mixer.clipAction( gltf.animations[ 0 ] ).play();
                    self.setContent(loadscene)
                  }, function (xhr) {

                    //模型加载状态
                    self.loadedData = Math.floor(xhr.loaded / xhr.total * 100);
                    if (self.loadedData == '100') {
                      let ld = document.getElementsByClassName('modelBorder')[self.index];
                      ld.style.backgroundImage = 'none';
                    }
                  });
              });

          },

          setContent(model) {
            let self = this; //这一点很重要。。
            let group = new THREE.Group();
            group.add(model);
            group.updateMatrixWorld();
            let bbox = new THREE.Box3().setFromObject(group);
            const boxSize = bbox.getSize(new THREE.Vector3());
            const center = bbox.getCenter(new THREE.Vector3());
            group.position.x += group.position.x - center.x;
            group.position.y += group.position.y - center.y;
            group.position.z += group.position.z - center.z;
            this.camera.position.copy(center);
            if (boxSize.x > boxSize.y) {
              this.camera.position.z = boxSize.x * -2.85
            } else {
              this.camera.position.z = boxSize.y * -2.85
            }
            this.camera.lookAt(0, 0, 0);

            //外框架
            let boxhelper = new THREE.BoxHelper(group, 0xbe1915); //外面红色框
            // self.scene.add(boxhelper);
            //坐标线
            let axesHelper = new THREE.AxesHelper(100);
            // self.scene.add(axesHelper);

            self.scene.add(group);

          },

          onWindowResize() {
            let self = this; //这一点很重要。。
            self.camera.aspect = this.width / this.height;
            self.camera.updateProjectionMatrix();
            self.renderer.setSize(this.width, this.height);

          },

          //

          animate() {
            let self = this; //这一点很重要。

            requestAnimationFrame(this.animate);

            // if (mixer) mixer.update(clock.getDelta());
            // this.controls.update(); // required if damping enabled

            self.renderer.render(self.scene, self.camera);
          }
        },
        mounted() {
          window.ob = this;
          this.init();
          this.animate();
        }
      })
    })();
  </script>
</body>



<!-- 图片预览服务 -->
<script src="./viewer.min@1.10.1.js" async="async"></script>
<link href="./viewer.min@1.10.1.css" rel="stylesheet" async="async">

<!-- 下载服务 -->
<script src="./download.min@v4.21.js"></script>

<!-- toast -->
<script src="./vs-toast.min@1.4.0.js" async="async"></script>

</html>